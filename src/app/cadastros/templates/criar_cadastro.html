<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Cadastro Geral</title>
</head>

<body>
    <h1>Cadastro Geral</h1>
    <form id="cadastroForm">
        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" name="cpf" required minlength="11" maxlength="11"><br><br>

        <label for="telefone">Telefone:</label>
        <input type="text" id="telefone" name="telefone" required minlength="11" maxlength="11"><br><br>

        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="name" required><br><br>

        <label for="data de nascimento">Data de Nascimento:</label>
        <input type="date" id="dt_nascimento" name="dt_nascimento" required><br><br>

        <label for="sexo">Sexo:</label>
        <select id="sexo" name="sexo" required>
            <option value="">Selecione...</option>
            {% for key, value in gender_choices.items() %}
            <option value="{{ value }}">{{ value }}</option>
            {% endfor %}
        </select><br><br>

        <label for="estado_civil">Estado Civil:</label>
        <select id="estado_civil" name="estado_civil" required>
            <option value="">Selecione...</option>
            {% for key, value in estado_civil_choices.items() %}
            <option value="{{ value }}">{{ value }}</option>
            {% endfor %}
        </select><br><br>

        <label for="escolaridade">Escolaridade:</label>
        <select id="escolaridade" name="escolaridade" required>
            <option value="">Selecione...</option>
            {% for key, value in escolaridade_choices.items() %}
            <option value="{{ value }}">{{ value }}</option>
            {% endfor %}
        </select><br><br>

        <label for="ocupacao">Ocupação:</label>
        <select id="ocupacao" name="ocupacao" required>
            <option value="">Selecione...</option>
            {% for key, value in ocupacao_choices.items() %}
            <option value="{{ value }}">{{ value }}</option>
            {% endfor %}
        </select><br><br>

        <label for="ocupacao_outro">Se "Outra", informe:</label>
        <input type="text" id="ocupacao_text" name="ocupacao_text"><br><br>

        <label for="bairro">Bairro:</label>
        <input type="text" id="bairro" name="bairro"><br><br>
        <label for="rua">Rua:</label>
        <input type="text" id="rua" name="rua"><br><br>
        <label for="numero">Número:</label>
        <input type="text" id="numero" name="numero"><br><br>


        <button type="submit">Cadastrar</button>
    </form>

    <script>
        document.getElementById('cadastroForm').addEventListener('submit', async function (event) {
            // Prevent the default form submission
            event.preventDefault();

            // Get the form data
            const form = event.target;
            const formData = new FormData(form);
            const data = {};

            // Format the form data json aproprietly
            data['endereco'] = {}
            formData.forEach((value, key) => {
                if (['bairro', 'rua', 'numero'].includes(key)) {
                    data['endereco'][key] = value
                }
                else {
                    data[key] = value
                }
            });

            try {
                const response = await fetch('/cadastros/create/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                if (response.ok) {
                    alert('Cadastro realizado com sucesso!');
                    // You can redirect or clear the form here
                } else {
                    const errorData = await response.json();
                    alert('Erro no cadastro: ' + JSON.stringify(errorData));
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Ocorreu um erro ao enviar o formulário.');
            }
        });
    </script>
</body>

</html>