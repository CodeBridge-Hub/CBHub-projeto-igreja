<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerenciar Sessões de Atendimento</title>
</head>
<body>
    <h1>Criar Sessão de Atendimento</h1>
    <form action="/atendimentos/sessao/" method="post">
        <label for="inicio">Início:</label>
        <input type="datetime-local" name="inicio" id="inicio" required>
        <br><br>
        <label for="fim">Fim:</label>
        <input type="datetime-local" name="fim" id="fim" required>
        <br><br>
        <button type="submit">Criar Sessão</button>
    </form>

    <hr>

    <h1>Adicionar Serviço a uma Sessão</h1>
    <form action="/atendimentos/sessao/add_servico" method="post">
        <label for="sessao_id">Selecionar Sessão:</label>
        <select name="sessao_id" id="sessao_id" required>
            {% for sessao in sessoes %}
                <option value="{{ sessao.id }}">Sessão {{ sessao.id }} ({{ sessao.inicio }} - {{ sessao.fim }})</option>
            {% endfor %}
        </select>
        <br><br>
        <label for="servico_id">Selecionar Serviço:</label>
        <select name="servico_id" id="szervico_id" required>
            {% for servico in servicos %}
                <option value="{{ servico.id }}">{{ servico.nome }}</option>
            {% endfor %}
        </select>
        <br><br>
        <button type="submit">Adicionar Serviço</button>
    </form>

    <hr>

    <h1>Sessões de Atendimento</h1>
    {% for sessao in sessoes %}
        <div>
            <strong>Sessão ID: {{ sessao.id }}</strong><br>
            Início: {{ sessao.inicio }}<br>
            Fim: {{ sessao.fim }}<br>
            Serviços disponíveis:
            <ul>
                {% for servico in sessao.servicos_disponiveis %}
                    <li>{{ servico.nome }} (ID: {{ servico.id }})</li>
                {% endfor %}
            </ul>

            <h3>Atendimentos</h3>
            <ul>
                {% for atendimento in sessao.atendimentos %}
                    <li>
                        ID: {{ atendimento.id }} - Serviço: {{ atendimento.servico.nome }} - Status: {{ atendimento.status }}
                        {% if atendimento.status != 'Encerrado' %}
                            <form action="/atendimentos/close/{{ atendimento.id }}/" method="post">
                                <button type="submit">Encerrar Atendimento</button>
                            </form>
                        {% endif %}
                    </li>
                {% else %}
                    <li>Nenhum atendimento nesta sessão</li>
                {% endfor %}
            </ul>
        </div>
    {% else %}
        <p>Nenhuma sessão cadastrada.</p>
    {% endfor %}
</body>
</html>
